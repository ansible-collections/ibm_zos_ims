

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Prerequisites &mdash; IBM z/OS IMS Collection 1.1.0-beta.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/banner.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="License" href="../license.html" />
    <link rel="prev" title="Contributing" href="../community_guides.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> IBM z/OS IMS Collection
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements-single.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../playbooks-single.html">Playbooks</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible Content</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Releases</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../community_guides.html">Contributing</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../community_guides.html#development">Development</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../community_guides.html#z-os-ansible-module-testing">z/OS Ansible Module Testing</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-and-dependencies">Configuration and Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-functional-and-unit-tests">Run Functional and Unit Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#develop-unit-tests-with-pytest">Develop Unit Tests with pytest</a></li>
<li class="toctree-l4"><a class="reference internal" href="#develop-functional-tests-with-pytest">Develop Functional Tests with pytest</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-development-tips">Additional Development Tips</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBM z/OS IMS Collection</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../community_guides.html">Contributing</a> &raquo;</li>
        
      <li>Prerequisites</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/ansible-collections/ibm_zos_ims/blob/v1.1.0-beta.1/docs/source/community_guides_docs/zos_ansible_module_testing.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  





<div class="section" id="prerequisites">
<h1>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h1>
<p>The following prerequisites must be met before you develop and run test cases
for z/OS Ansible modules.</p>
<div class="section" id="control-node">
<h2>Control node<a class="headerlink" href="#control-node" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html">Ansible version</a>: 2.9 or later</p></li>
<li><p><a class="reference external" href="https://www.python.org/downloads/release/latest">Python</a>: 3 or later</p></li>
<li><p><a class="reference external" href="https://www.openssh.com/">OpenSSH</a></p></li>
</ul>
</div>
<div class="section" id="managed-node">
<h2>Managed node<a class="headerlink" href="#managed-node" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p><a class="reference external" href="http://www.ibm.com/products/open-enterprise-python-zos">IBM Open Enterprise Python for z/OS</a></p></li>
<li><p>z/OS <a class="reference external" href="https://www.ibm.com/support/knowledgecenter/SSLTBW_2.3.0/com.ibm.zos.v2r3/en/homepage.html">V2R3</a> or <a class="reference external" href="https://www.ibm.com/support/knowledgecenter/SSLTBW">later</a></p></li>
<li><p><a class="reference external" href="https://www.ibm.com/support/knowledgecenter/en/SSKFYE">IBM Z Open Automation Utilities</a> (ZOAU)</p></li>
<li><p>The z/OS® shell</p>
<blockquote>
<div><ul class="simple">
<li><p>IBM z/OS collections are dependent on specific versions of ZOAU. When
configuring the dependencies, refer to the requirements
and dependencies of the particular collection to ensure proper execution.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><a class="reference external" href="https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.e0za100/ch1openssh.htm">z/OS OpenSSH</a></p></li>
</ul>
</div>
</div>
<div class="section" id="configuration-and-dependencies">
<h1>Configuration and Dependencies<a class="headerlink" href="#configuration-and-dependencies" title="Permalink to this headline">¶</a></h1>
<p>This section explains how to configure the environment and which dependencies to
install to run both the functional and unit test cases.</p>
<div class="section" id="install-dependencies">
<h2>Install dependencies<a class="headerlink" href="#install-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Install the requirements using the supplied <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> with <code class="docutils literal notranslate"><span class="pre">pip3</span></code>.
In the root folder of the collection, run the command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pip3 install -r tests/requirements.txt
</pre></div>
</div>
<p>If the command responds with <code class="docutils literal notranslate"><span class="pre">ERROR:</span> <span class="pre">Could</span> <span class="pre">not</span> <span class="pre">install</span> <span class="pre">packages</span> <span class="pre">due</span> <span class="pre">to</span> <span class="pre">an</span> <span class="pre">EnvironmentError:</span> <span class="pre">[Errno</span> <span class="pre">13]</span> <span class="pre">Permission</span> <span class="pre">denied</span></code>,
run the command with the additional <code class="docutils literal notranslate"><span class="pre">-user</span></code> option:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pip3 install --user -r tests/requirements.txt
</pre></div>
</div>
</div>
<div class="section" id="ssh-keys">
<h2>SSH Keys<a class="headerlink" href="#ssh-keys" title="Permalink to this headline">¶</a></h2>
<p>Generate and add a new SSH key using <a class="reference external" href="https://www.ssh.com/ssh/keygen/">ssh-keygen</a> and <a class="reference external" href="https://www.ssh.com/ssh/add">ssh-add</a>.</p>
<img alt="https://zenhub.ibm.com/images/5c75c71e85b6d5070636e1d8/8bd18b60-7517-4301-b3d4-17857e3a5e49" src="https://zenhub.ibm.com/images/5c75c71e85b6d5070636e1d8/8bd18b60-7517-4301-b3d4-17857e3a5e49" />
<p>Copy the public key to a target host, using <a class="reference external" href="https://www.ssh.com/ssh/copy-id">ssh-copy-id</a>.</p>
<img alt="https://zenhub.ibm.com/images/5c75c71e85b6d5070636e1d8/63102702-1dd4-4578-8539-33beb496bf69" src="https://zenhub.ibm.com/images/5c75c71e85b6d5070636e1d8/63102702-1dd4-4578-8539-33beb496bf69" />
</div>
<div class="section" id="configuration-and-arguments">
<h2>Configuration and Arguments<a class="headerlink" href="#configuration-and-arguments" title="Permalink to this headline">¶</a></h2>
<p>Create a YAML file containing the required information to run the functional tests.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 4%" />
<col style="width: 89%" />
<col style="width: 3%" />
<col style="width: 3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Aliases</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>host</p></td>
<td><p>The z/OS target host to connect to.</p></td>
<td><p>True</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>user</p></td>
<td><p>The username for authentication with host.</p></td>
<td><p>True</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>python_path</p></td>
<td><p>The absolute path to the python interpreter on the z/OS target host.</p></td>
<td><p>True</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>environment</p></td>
<td><p>A list of key-value pairs containing all environment variables that must be set on the z/OS target host before running Python/Ansible. It is important to add two sets of quotes when quotations are desired in the environment variable _export_ statement.</p></td>
<td><p>False</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>Example YAML configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some.host.name</span>
<span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myuser</span>
<span class="nt">python_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/lpp/IBM/cyp/v3r8/pyz</span>
<span class="nt">environment</span><span class="p">:</span>
  <span class="nt">_BPXK_AUTOCVT</span><span class="p">:</span> <span class="s">&quot;ON&quot;</span>
  <span class="nt">_CEE_RUNOPTS</span><span class="p">:</span> <span class="s">&quot;&#39;FILETAG(AUTOCVT,AUTOTAG)</span><span class="nv"> </span><span class="s">POSIX(ON)&#39;&quot;</span>
  <span class="nt">_TAG_REDIR_ERR</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">txt</span>
  <span class="nt">_TAG_REDIR_IN</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">txt</span>
  <span class="nt">_TAG_REDIR_OUT</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">txt</span>
  <span class="nt">LANG</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C</span>
  <span class="nt">ZOAU_ROOT</span><span class="p">:</span> <span class="s">&quot;/usr/lpp/IBM/zoautil&quot;</span>
  <span class="nt">ZOAU_HOME</span><span class="p">:</span> <span class="s">&quot;/usr/lpp/IBM/zoautil&quot;</span>
  <span class="nt">LIBPATH</span><span class="p">:</span> <span class="s">&quot;/usr/lpp/IBM/zoautil/lib:/usr/lpp/IBM/cyp/v3r8/pyz/lib:/lib:/usr/lib:.&quot;</span>
  <span class="nt">ZOAUTIL_DIR</span><span class="p">:</span> <span class="s">&quot;/usr/lpp/IBM/zoautil&quot;</span>
  <span class="nt">PYTHONPATH</span><span class="p">:</span> <span class="s">&quot;/usr/lpp/IBM/zoautil/lib&quot;</span>
  <span class="nt">PATH</span><span class="p">:</span> <span class="s">&quot;/usr/lpp/IBM/zoautil/bin:/usr/lpp/IBM/cyp/v3r8/pyz/bin:/bin:/var/bin&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-functional-and-unit-tests">
<h1>Run Functional and Unit Tests<a class="headerlink" href="#run-functional-and-unit-tests" title="Permalink to this headline">¶</a></h1>
<p>After completing the steps in “Configuration and Dependencies”, you can run the
functional and unit tests. Running the functional tests requires access to a
z/OS system; the unit tests do not require z/OS access.</p>
<div class="section" id="run-functional-tests">
<h2>Run Functional Tests<a class="headerlink" href="#run-functional-tests" title="Permalink to this headline">¶</a></h2>
<p>To run the functional tests, you will need a Python 3 environment.
Pass the YAML configuration to the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> command  with the option <code class="docutils literal notranslate"><span class="pre">--zinventory</span></code>
or <code class="docutils literal notranslate"><span class="pre">-z</span></code>. By default, <code class="docutils literal notranslate"><span class="pre">pytest</span></code> looks for the YAML configuration in the local
directory as <strong>test-config.yaml</strong>.</p>
<p>In this example, the path to the YAML configuration is <strong>/home/myuser/test_config.yml</strong>.</p>
<p>If the environment is using Python 2 or Python 3 is not present in the host PATH:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$ python3 -m pytest --host-pattern=all --zinventory=/home/myuser/test_config.yml</span>
</pre></div>
</div>
<p>If the environment is configured with Python 3:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$ pytest --host-pattern=all --zinventory=/home/myuser/test_config.yml</span>
</pre></div>
</div>
</div>
<div class="section" id="run-unit-tests">
<h2>Run Unit Tests<a class="headerlink" href="#run-unit-tests" title="Permalink to this headline">¶</a></h2>
<p>The unit tests require minimal configuration to get started and do not require
access to a z/OS system to run. To run the unit tests, navigate to the
unit tests folder:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ansible_collections_ibm_zos_ims
└── tests
    └── units
</pre></div>
</div>
<p>If the environment is using Python 2 or Python 3 is not in the host PATH:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$ python3 -m pytest</span>
</pre></div>
</div>
<p>If the environment is configured with Python 3:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$ pytest</span>
</pre></div>
</div>
</div>
<div class="section" id="cli-arguments">
<h2>CLI Arguments<a class="headerlink" href="#cli-arguments" title="Permalink to this headline">¶</a></h2>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> options <code class="docutils literal notranslate"><span class="pre">--zinventory``or</span> <span class="pre">``-z</span></code> are used to provide
the absolute path to the configuration YAML file. Additionally, certain select
arguments from <a class="reference external" href="https://github.com/ansible/pytest-ansible">pytest-ansible</a> can be used. These can be passed as command
line options or provided in the YAML configuration file
<strong>/home/myuser/test_config.yml</strong>.</p>
<p>Some options noted below with <strong>NOT SUPPORTED</strong>, may work with additional
testing.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pytest <span class="se">\</span>
    NOT SUPPORTED <span class="o">[</span>--inventory &lt;path_to_inventory&gt;<span class="o">]</span> <span class="se">\</span>
    REQUIRED <span class="o">[</span>--host-pattern &lt;host-pattern&gt;<span class="o">]</span> <span class="se">\</span>
    <span class="o">[</span>--connection &lt;plugin&gt;<span class="o">]</span> <span class="se">\</span>
    BROKEN <span class="o">[</span>--module-path &lt;path_to_modules<span class="o">]</span> <span class="se">\</span>
    <span class="o">[</span>--user &lt;username&gt;<span class="o">]</span> <span class="se">\</span>
    <span class="o">[</span>--become<span class="o">]</span> <span class="se">\</span>
    <span class="o">[</span>--become-user &lt;username&gt;<span class="o">]</span> <span class="se">\</span>
    <span class="o">[</span>--become-method &lt;method&gt;<span class="o">]</span> <span class="se">\</span>
    NOT SUPPORTED <span class="o">[</span>--limit &lt;limit&gt;<span class="o">]</span> <span class="se">\</span>
    <span class="o">[</span>--check<span class="o">]</span>
</pre></div>
</div>
<p>If you choose to use the options in the command over <strong>test_config.yaml</strong>, a
command line example would look like:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pytest --host-pattern<span class="o">=</span>all --user guest --become-user root --zinventory<span class="o">=</span>/home/myuser/test_config.yml
</pre></div>
</div>
</div>
<div class="section" id="add-module-directory-to-ansible-library">
<h2>Add module directory to ANSIBLE_LIBRARY<a class="headerlink" href="#add-module-directory-to-ansible-library" title="Permalink to this headline">¶</a></h2>
<p>Typically, <code class="docutils literal notranslate"><span class="pre">module_path</span></code> in the YAML configuration, or <code class="docutils literal notranslate"><span class="pre">--module-path</span></code> on the CLI would be
a valid parameter which would function as an alternative to setting the
ANSIBLE_LIBRARY environment variable. However, this option is not functional in the
<strong>2.9.5</strong> Ansible release.</p>
<p>If the modules are in:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>/
└── Users
    └── myuser
        └── ansible_collections_ibm_zos_ims
            └── plugins
                └── modules
</pre></div>
</div>
<p>Use this command to add the module directory to <strong>ANSIBLE_LIBRARY</strong> :</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">ANSIBLE_LIBRARY</span><span class="o">=</span>/Users/myuser/ansible_collections_ibm_zos_ims/plugins/modules
</pre></div>
</div>
<p>Now that the module directory has been exported, navigate to the functional
tests folder to run the test with the added module directory.</p>
<p>Navigate to the functional tests folder:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ansible_collections_ibm_zos_ims
└── tests
    └── functional
</pre></div>
</div>
<p>If the environment is using Python 2 or Python 3 is not in the host PATH:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ python3 -m pytest --host-pattern<span class="o">=</span>all --zinventory<span class="o">=</span>/home/myuser/test_config.yml
</pre></div>
</div>
<p>If the environment is configured with Python 3:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$ pytest --host-pattern=all --zinventory=/home/myuser/test_config.yml</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="develop-unit-tests-with-pytest">
<h1>Develop Unit Tests with pytest<a class="headerlink" href="#develop-unit-tests-with-pytest" title="Permalink to this headline">¶</a></h1>
<p>This section provides an overview of unit and functional testing z/OS Ansible
modules. Multiple <a class="reference external" href="https://docs.pytest.org/en/latest/fixture.html">pytest fixtures</a> are provided to simplify the testing
process.</p>
<div class="section" id="mocking-z-os-packages-methods-and-functions">
<h2>Mocking z/OS Packages, Methods, and Functions<a class="headerlink" href="#mocking-z-os-packages-methods-and-functions" title="Permalink to this headline">¶</a></h2>
<p>Unit tests do not require access to a z/OS system for execution. When
functions or methods are dependent on a missing z/OS Python package such
as <cite>zoautil_py</cite>, the imports of both the package and direct calls to the
missing library should be “mocked”.</p>
</div>
<div class="section" id="unit-testing-resources">
<h2>Unit Testing Resources<a class="headerlink" href="#unit-testing-resources" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p><a class="reference external" href="https://docs.python.org/3/library/unittest.mock.html">unittest.mock</a> - allows you to replace parts of your system under test with
mock objects and make assertions about how they have been used.</p>
<p><code class="docutils literal notranslate"><span class="pre">pip</span></code> can be used to install <code class="docutils literal notranslate"><span class="pre">mock</span></code> in python 2 and 3. In Python 3,
<code class="docutils literal notranslate"><span class="pre">unittest.mock</span></code> is included with the Python installation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While examples may reference <code class="docutils literal notranslate"><span class="pre">unittest.mock</span></code>, or <code class="docutils literal notranslate"><span class="pre">mock</span></code>
directly for certain purposes, the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> framework is the recommended
testing framework. The use of the <code class="docutils literal notranslate"><span class="pre">unittest</span></code> framework is not recommended.</p>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/pytest-dev/pytest-mock">pytest-mock</a> - installs a <code class="docutils literal notranslate"><span class="pre">mocker</span></code> fixture which is a thin-wrapper around
the patching API provided by the mock package, but with the benefit of not
having to worry about undoing patches at the end of a test.</p></li>
</ul>
</div>
<div class="section" id="zos-import-mocker">
<h2>zos_import_mocker<a class="headerlink" href="#zos-import-mocker" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/ansible-collections/ibm_zos_ims/blob/dev/tests/conftest.py#L57">zos_import_mocker</a> pytest fixture is designed to simplify mocking import
dependencies without disrupting any of the existing operations.</p>
<p><a class="reference external" href="https://github.com/ansible-collections/ibm_zos_ims/blob/dev/tests/conftest.py#L57">zos_import_mocker</a> returns two items when it is provided to a test:</p>
<ol class="arabic">
<li><p>A mocker object from <a class="reference external" href="https://github.com/pytest-dev/pytest-mock">pytest-mock</a>.</p>
<p>From the docs:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>a thin-wrapper around the patching API provided by the mock package, but
with the benefit of not having to worry about undoing patches at the end
of a test
</pre></div>
</div>
</div></blockquote>
<p>Behind the scenes, <code class="docutils literal notranslate"><span class="pre">zos_import_mocker</span></code> uses the mocker fixture to patch
the <code class="docutils literal notranslate"><span class="pre">zoautil_py</span></code> package with a MagicMock object. With <code class="docutils literal notranslate"><span class="pre">zoautil_py</span></code>
patched, modules that depend on <code class="docutils literal notranslate"><span class="pre">zoautil_py</span></code> can be imported and used
without raising exceptions.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">perform_imports()</span></code> function.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">perform_imports()</span></code> function accepts a single import string or a list
of import strings as arguments. Imports that depend on <code class="docutils literal notranslate"><span class="pre">zoautil_py</span></code> should
utilize this function to simplify imports.</p>
<p>It returns the imports for use by the test cases. If a single import string
was provided, a single import is returned. If a list of import strings was
provided, a list of imports is returned.</p>
<p>The example code assigns the name <code class="docutils literal notranslate"><span class="pre">importer()</span></code> to the returned
<code class="docutils literal notranslate"><span class="pre">perform_imports()</span></code> function.</p>
</li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">zos_import_mocker</span></code> uses function scope. Therefore, the mock of
<code class="docutils literal notranslate"><span class="pre">zoautil_py</span></code> and any operations performed with the provided mocker will be
cleared after each function.</p>
</div>
<div class="section" id="example-zos-import-mocker-usage">
<h2>Example <code class="docutils literal notranslate"><span class="pre">zos_import_mocker</span></code> Usage<a class="headerlink" href="#example-zos-import-mocker-usage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">)</span>
<span class="n">__metaclass__</span> <span class="o">=</span> <span class="nb">type</span>

<span class="kn">from</span> <span class="nn">ansible.module_utils.basic</span> <span class="kn">import</span> <span class="n">AnsibleModule</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">mock</span> <span class="kn">import</span> <span class="n">call</span>

<span class="c1"># The IMPORT_NAME import string is passed to importer() in each test case</span>
<span class="n">IMPORT_NAME</span> <span class="o">=</span> <span class="s1">&#39;ansible_collections_ibm_zos_imse.plugins.module   s.datasets.zos_dataset&#39;</span>

<span class="c1"># Tests for create_dataset()</span>
<span class="n">dummy_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;pds&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="s1">&#39;50M&#39;</span>
<span class="p">}</span>

<span class="n">test_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;test1.tester.test&#39;</span><span class="p">,</span> <span class="n">dummy_dict</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;test1.tester.test&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{},</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;test1.tester.test&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;test1.tester.test&#39;</span><span class="p">,</span> <span class="n">dummy_dict</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;dsname,args,return_value,expected&quot;</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_create_dataset_various_args</span><span class="p">(</span><span class="n">zos_import_mocker</span><span class="p">,</span> <span class="n">dsname</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">return_value</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="n">mocker</span><span class="p">,</span> <span class="n">importer</span> <span class="o">=</span> <span class="n">zos_import_mocker</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">importer</span><span class="p">(</span><span class="n">IMPORT_NAME</span><span class="p">)</span>
    <span class="n">passed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;zoautil_py.Datasets.create&#39;</span><span class="p">,</span>
                <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="n">return_value</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">dsname</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ds</span><span class="o">.</span><span class="n">DatasetCreateError</span><span class="p">:</span>
        <span class="n">passed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># MagicMock throws TypeError when input args is None</span>
        <span class="c1"># But if it gets that far we consider it passed</span>
        <span class="k">if</span> <span class="s1">&#39;MagicMock&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="n">passed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">assert</span> <span class="n">passed</span> <span class="o">==</span> <span class="n">expected</span>

<span class="k">def</span> <span class="nf">test_create_dataset_missing_all_args</span><span class="p">(</span><span class="n">zos_import_mocker</span><span class="p">):</span>
    <span class="n">mocker</span><span class="p">,</span> <span class="n">importer</span> <span class="o">=</span> <span class="n">zos_import_mocker</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">importer</span><span class="p">(</span><span class="n">IMPORT_NAME</span><span class="p">)</span>
    <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;zoautil_py.Datasets.create&#39;</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">test_create_dataset_missing_second_arg</span><span class="p">(</span><span class="n">zos_import_mocker</span><span class="p">):</span>
    <span class="n">mocker</span><span class="p">,</span> <span class="n">importer</span> <span class="o">=</span> <span class="n">zos_import_mocker</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">importer</span><span class="p">(</span><span class="n">IMPORT_NAME</span><span class="p">)</span>
    <span class="n">patched_method</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
        <span class="s1">&#39;zoautil_py.Datasets.create&#39;</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;testname&#39;</span><span class="p">)</span>
    <span class="n">patched_method</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="s1">&#39;testname&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_create_dataset_arg_expansion</span><span class="p">(</span><span class="n">zos_import_mocker</span><span class="p">):</span>
    <span class="n">mocker</span><span class="p">,</span> <span class="n">importer</span> <span class="o">=</span> <span class="n">zos_import_mocker</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">importer</span><span class="p">(</span><span class="n">IMPORT_NAME</span><span class="p">)</span>
    <span class="n">item1</span> <span class="o">=</span> <span class="s1">&#39;value1&#39;</span>
    <span class="n">item2</span> <span class="o">=</span> <span class="s1">&#39;value2&#39;</span>
    <span class="n">item3</span> <span class="o">=</span> <span class="s1">&#39;value3&#39;</span>
    <span class="n">to_expand</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;item1&#39;</span><span class="p">:</span> <span class="n">item1</span><span class="p">,</span>
        <span class="s1">&#39;item2&#39;</span><span class="p">:</span> <span class="n">item2</span><span class="p">,</span>
        <span class="s1">&#39;item3&#39;</span><span class="p">:</span> <span class="n">item3</span>
    <span class="p">}</span>
    <span class="n">patched_method</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
        <span class="s1">&#39;zoautil_py.Datasets.create&#39;</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;testname&#39;</span><span class="p">,</span> <span class="n">to_expand</span><span class="p">)</span>
    <span class="n">patched_method</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>
        <span class="s1">&#39;testname&#39;</span><span class="p">,</span> <span class="n">item1</span><span class="o">=</span><span class="n">item1</span><span class="p">,</span> <span class="n">item2</span><span class="o">=</span><span class="n">item2</span><span class="p">,</span> <span class="n">item3</span><span class="o">=</span><span class="n">item3</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_create_dataset_exception_receiving_name</span><span class="p">(</span><span class="n">zos_import_mocker</span><span class="p">):</span>
    <span class="n">mocker</span><span class="p">,</span> <span class="n">importer</span> <span class="o">=</span> <span class="n">zos_import_mocker</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">importer</span><span class="p">(</span><span class="n">IMPORT_NAME</span><span class="p">)</span>
    <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;zoautil_py.Datasets.create&#39;</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ds_name</span> <span class="o">=</span> <span class="s1">&#39;testdsn&#39;</span>
    <span class="n">patched_method</span> <span class="o">=</span> <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">DatasetCreateError</span><span class="p">,</span> <span class="s1">&#39;__init__&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;testdsn&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ds</span><span class="o">.</span><span class="n">DatasetCreateError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">patched_method</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">ds_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="develop-functional-tests-with-pytest">
<h1>Develop Functional Tests with pytest<a class="headerlink" href="#develop-functional-tests-with-pytest" title="Permalink to this headline">¶</a></h1>
<p>Functional tests should execute modules on the z/OS target node and validate
return values are valid and desired action(s) are achieved.</p>
<div class="section" id="functional-testing-resources">
<h2>Functional Testing Resources<a class="headerlink" href="#functional-testing-resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ansible/pytest-ansible">pytest-ansible</a> - contains a plugin for <code class="docutils literal notranslate"><span class="pre">pytest</span></code> which adds several
fixtures for running ansible modules, or inspecting ansible_facts.</p></li>
</ul>
<p>The plugin from <code class="docutils literal notranslate"><span class="pre">pytest-ansible</span></code> is used by one of our own pytest fixtures.</p>
<p><cite>pytest-ansible</cite> does not work out of the box for z/OS Ansible modules due
to <cite>pytest-ansible</cite> using the <cite>adhoc</cite> command to drive module testing behind
the scenes. <cite>adhoc</cite> commands do not support setting environment variables on
the target host, which is needed to run z/OS Python.</p>
<p>The <a class="reference external" href="https://github.com/ansible-collections/ibm_zos_ims/blob/dev/tests/conftest.py#L37">ansible_zos_module</a> pytest fixture reads the <a class="reference external" href="zos_ansible_module_testing.html#configuration-and-arguments">YAML configuration</a>,
provisions a temporary python interpreter, and sets up the <code class="docutils literal notranslate"><span class="pre">ansible</span></code> plugin
from <code class="docutils literal notranslate"><span class="pre">pytest-ansible</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">ansible_zos_module</span></code> returns the equivalent of the
<a class="reference external" href="https://github.com/ansible/pytest-ansible#fixture-ansible_adhoc">pytest-ansible adhoc fixture</a> and can be used similarly.</p>
</div>
<div class="section" id="details">
<h2>Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ansible_zos_module</span></code> uses the <code class="docutils literal notranslate"><span class="pre">request</span></code> and <a class="reference external" href="https://github.com/ansible-collections/ibm_zos_ims/blob/dev/tests/conftest.py">z_python_interpreter</a>
fixtures.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">z_python_interpreter</span></code> fixture performs the following actions:</p>
<ol class="arabic simple">
<li><p>Parses the YAML config.</p></li>
<li><p>Builds our new interpreter by wrapping the provided Python interpreter with
needed environment configuration.</p></li>
<li><p>Builds a dictionary containing all of the arguments from the YAML
configuration that should be passed to the <code class="docutils literal notranslate"><span class="pre">ansible</span> <span class="pre">pytest-ansible</span></code> plugin.</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">z_python_interpreter</span></code> fixture returns two values:</p>
<ol class="arabic">
<li><p><strong>interpreter</strong> - the temporary interpreter string.</p>
<p><code class="docutils literal notranslate"><span class="pre">ansible_zos_module</span></code> injects the interpreter string into the default
interpreter path variable used by the <code class="docutils literal notranslate"><span class="pre">ansible</span> <span class="pre">pytest-ansible</span></code> plugin so
the temporary interpreter string is used when running modules.</p>
<blockquote>
<div><p>The <cite>interpreter</cite> variable is a string containing all of the environment
variable exports followed by the python interpreter. The export statements
are required, otherwise USS will not execute the interpreter.</p>
</div></blockquote>
</li>
<li><p><strong>inventory</strong> - a dictionary containing all of the arguments to provide
during <code class="docutils literal notranslate"><span class="pre">ansible</span> <span class="pre">pytest-ansible</span></code> plugin initialization.</p>
<p><code class="docutils literal notranslate"><span class="pre">ansible_zos_module</span></code> handles the plugin initialization.</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">z_python_interpreter</span></code> shouldn’t be used directly. It is solely
used as a fixture to <code class="docutils literal notranslate"><span class="pre">ansible_zos_module</span></code>.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ansible_zos_module</span></code> is scoped to the test session. Therefore, only one
temporary Python interpreter is used each time Pytest is run.</p>
</div>
<div class="section" id="example-ansible-zos-module-usage">
<h2>Example <code class="docutils literal notranslate"><span class="pre">ansible_zos_module</span></code> usage<a class="headerlink" href="#example-ansible-zos-module-usage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">ansible.constants</span>
<span class="kn">import</span> <span class="nn">ansible.errors</span>
<span class="kn">import</span> <span class="nn">ansible.utils</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="n">__metaclass__</span> <span class="o">=</span> <span class="nb">type</span>

<span class="k">def</span> <span class="nf">test_dataset_creation</span><span class="p">(</span><span class="n">ansible_zos_module</span><span class="p">):</span>
    <span class="n">hosts</span> <span class="o">=</span> <span class="n">ansible_zos_module</span>
    <span class="c1"># * hosts.all.zos_dataset tells adhoc to run the zos_datset module against all provided hosts.</span>
    <span class="c1"># * In our case, there is only a single host. This may change in the future.</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">hosts</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">zos_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;imsbank.ims1.test01&#39;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s1">&#39;present&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># * results.contacted contains a list where each list item represents a host on which the module ran</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">contacted</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;present&#39;</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;changed&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;module_stderr&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="additional-development-tips">
<h1>Additional Development Tips<a class="headerlink" href="#additional-development-tips" title="Permalink to this headline">¶</a></h1>
<p>When using <code class="docutils literal notranslate"><span class="pre">ansible_zos_module</span></code>, it may be beneficial to view the structure
output by <strong>results.contacted</strong> or other objects.</p>
<p>The <a class="reference external" href="https://docs.python.org/3/library/pprint.html">pprint</a> Python module can be used to format output.</p>
<p>By using <code class="docutils literal notranslate"><span class="pre">pprint.pprint(vars(someobject))</span></code>, we can print content from any
object containing <code class="docutils literal notranslate"><span class="pre">__dict__</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">ansible.constants</span>
<span class="kn">import</span> <span class="nn">ansible.errors</span>
<span class="kn">import</span> <span class="nn">ansible.utils</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">__metaclass__</span> <span class="o">=</span> <span class="nb">type</span>

<span class="k">def</span> <span class="nf">test_dataset_creation</span><span class="p">(</span><span class="n">ansible_zos_module</span><span class="p">):</span>
    <span class="n">hosts</span> <span class="o">=</span> <span class="n">ansible_zos_module</span>
    <span class="c1"># * hosts.all.zos_dataset tells adhoc to run the zos_datset module against all provided hosts.</span>
    <span class="c1"># * In our case, there is only a single host. This may change in the future.</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">hosts</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">zos_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;imsbank.ims1.test01&#39;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s1">&#39;present&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># * results.contacted contains a list where each list item represents a host on which the module ran</span>
    <span class="n">pprint</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">contacted</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;present&#39;</span>
        <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;changed&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;module_stderr&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span>
</pre></div>
</div>
<p>To get debug output when running pytest, use the <cite>-s</cite> flag.
Assuming the absolute path of the YAML configuration file is
<strong>/home/myuser/test_config.yml</strong></p>
<p>The the environment is using Python 2 or Python 3 is not in the host PATH:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python3 -m pytest -s --host-pattern<span class="o">=</span>all --zinventory<span class="o">=</span>/home/myuser/test_config.yml
</pre></div>
</div>
<p>The the environment is configured with Python 3:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pytest -s --host-pattern<span class="o">=</span>all --zinventory<span class="o">=</span>/home/myuser/test_config.yml
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../license.html" class="btn btn-neutral float-right" title="License" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../community_guides.html" class="btn btn-neutral float-left" title="Contributing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, IBM

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: v1.1.0-beta.1
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="zos_ansible_module_testing.html">v1.1.0-beta.1</a></dd>
            <dd><a href="../../v1.0.0-beta1/index.html">v1.0.0-beta1</a></dd>
            <dd><a href="../../v1.0.0-beta2/index.html">v1.0.0-beta2</a></dd>
            <dd><a href="../../v1.0.0-beta3/community_guides_docs/zos_ansible_module_testing.html">v1.0.0-beta3</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>